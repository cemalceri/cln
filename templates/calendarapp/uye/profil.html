{% extends 'base/base.html' %}
{% load static %}
{% block title %}
    Profil
{% endblock %}
{% block extracss %}
    {% include 'base/remark_css.html' %}
    <link rel="stylesheet" href="{% static 'template/classic/base/assets/examples/css/pages/profile.css' %}">
{% endblock extracss %}

{% block extrascripts %}
    {% include 'base/remark_js.html' %}
    <script src="{% static 'template/classic/global/js/Plugin/responsive-tabs.js' %}"></script>
    <script src="{% static 'template/classic/global/js/Plugin/tabs.js' %}"></script>
    {#    <script>#}
    {#        (document, window, jQuery);#}
    {#    </script>#}
{% endblock extrascripts %}
{% block content %}
    <div class="page-content container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <!-- Page Widget -->
                <div class="card card-shadow">
                    <div class="card-header">
                        <h3 class="card-title">Üye Bilgileri</h3>
                    </div>
                    <div class="card-block">
                        <div class="row">
                            <div class="col-md-3">
                                <img class="img-fluid" src="{% static 'template/classic/global/portraits/5.jpg' %}"
                                     alt="...">
                                <h4 class="profile-user">{{ uye.adi }} {{ uye.soyadi }}</h4>
                                <div class="profile-social">
                                    <a class="icon bd-twitter" href="javascript:void(0)"></a>
                                    <a class="icon bd-facebook" href="javascript:void(0)"></a>
                                    <a class="icon bd-dribbble" href="javascript:void(0)"></a>
                                    <a class="icon bd-github" href="javascript:void(0)"></a>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="row">

                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Doğum
                                            Tarihi:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.dogum_tarihi |default_if_none:"" }}" autocomplete="off"
                                               disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Üye No:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.uye_no }}" autocomplete="off" disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Kimlik No:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.kimlik_no|default_if_none:"" }}" autocomplete="off"
                                               disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Telefon:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.telefon|default_if_none:"" }}" autocomplete="off"
                                               disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">E-Mail:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.email|default_if_none:"" }}" autocomplete="off" disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Adres:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.adres|default_if_none:"" }}" autocomplete="off" disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Seviye
                                            Rengi:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.get_seviye_rengi_display|default_if_none:"" }}"
                                               autocomplete="off"
                                               disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Okul:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.okul|default_if_none:"" }}" autocomplete="off" disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Onay Durumu:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.onaylandi_mi|yesno:"Evet,Hayır" }}" autocomplete="off"
                                               disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Aktif mi:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.aktif_mi|yesno:"Evet,Hayır" }}" autocomplete="off"
                                               disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Üye Tipi:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.get_uye_tipi_display|default_if_none:"" }}"
                                               autocomplete="off"
                                               disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="">Veli Ad Soyad:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.veli_adi_soyadi |default_if_none:"" }}" autocomplete="off"
                                               disabled/>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-control-label" for="inputBasicFirstName">Veli
                                            Telefon:</label>
                                        <input type="text" class="form-control" id="inputBasicFirstName"
                                               name="first_name"
                                               value="{{ uye.veli_telefon |default_if_none:"" }}" autocomplete="off"
                                               disabled/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="row no-space">
                            <div class="col-4">
                                <strong class="profile-stat-count">260</strong>
                                <span> Yapılan Ders</span>
                            </div>
                            <div class="col-4">
                                <strong class="profile-stat-count">180</strong>
                                <span>Planlanan Ders</span>
                            </div>
                            <div class="col-4">
                                <strong class="profile-stat-count">2000</strong>
                                <span>İptal Ders</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Page Widget -->
            </div>
            <div class="col-lg-12">
                <div class="card card-shadow">
                    <div class="card-header">
                        <h3 class="card-title">Paket ve Abonelikler</h3>
                    </div>
                    <div class="card-block border-bottom">
                        <div class="">
                            </b><h4 class="text-center">Abonelikler</h4>
                        </div>
                        <div class="table-responsive">
                            <div class="container-fluid ">
                                <div class="col-sm-12">
                                    <table class="table table-bordered dataTable table-fixed">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Kişiler</th>
                                            <th>Kort</th>
                                            <th>Gün</th>
                                            <th>Başlangıç - Bitiş</th>
                                            <th>Süre</th>
                                            <th>Aktif Mi</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for abonelik in abonelikler %}
                                            <tr>
                                                <td class="sorting_1">{{ forloop.counter }}</td>
                                                <td>{{ abonelik.grup }}</td>
                                                <td>{{ abonelik.kort }}</td>
                                                <td>{{ abonelik.gun_adi }}</td>
                                                <td>{{ abonelik.baslangic_tarih_saat| time:'H:i' }}
                                                    - {{ abonelik.bitis_tarih_saat| default_if_none:"" | time:'H:i' }}</td>
                                                <td>{{ abonelik.dakika_degeri }}</td>
                                                <td>{{ abonelik.aktif_mi | yesno:"Evet,Hayır" }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-block">
                        <div>
                            <a href="{% url 'calendarapp:kaydet_uye_paket' uye.id %}"
                               class="btn btn-success m-10 float-right"><i class="fa fa-plus "></i>Paket Ekle</a>
                            </b><h4 class="text-center">Paketler</h4>
                        </div>
                        <div class="table-responsive">
                            <div class="container-fluid ">
                                <div class="col-sm-12">
                                    <table class="table table-bordered dataTable table-fixed">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Başlangıç - Bitiş</th>
                                            <th>Adet</th>
                                            <th>Kalan Adet</th>
                                            <th>Aktif Mi</th>
                                            <th>Grup Paketi Mi</th>
                                            <th>Özellikler</th>
                                            <th>İşlemler</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for paket in paketler %}
                                            <tr>
                                                <td class="sorting_1">{{ forloop.counter }}</td>
                                                <td>{{ paket.baslangic_tarih }}
                                                    - {{ paket.bitis_tarih|default_if_none:"" }}</td>
                                                <td>{{ paket.adet }}</td>
                                                <td>{{ paket.kalan_adet }}</td>
                                                <td>{{ paket.aktif_mi | yesno:"Evet,Hayır" }}</td>
                                                <td>{{ paket.grup_mu | yesno:"Evet,Hayır" }}</td>
                                                <td>{{ paket.ozellikler | default_if_none:"" }}</td>
                                                <td>
                                                    <a class="btn btn-primary btn-circle"
                                                       href="{% url 'calendarapp:guncelle_uye_paket' paket.id %}"
                                                       title="Kaydı Düzenle"><i
                                                            class="fa fa-edit black"></i></a>
                                                    <a href="{% url 'calendarapp:sil_uye_paket' paket.id %}"
                                                       class="btn btn-danger btn-circle confirm-delete"
                                                       title="Sil" data-toggle="modal"
                                                       data-target="#confirmDeleteModal"
                                                       id="delete_uye_{{ abonelik.id }}">
                                                        <i class="fa fa-trash black"></i></a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="card card-shadow">
                    <div class="card-header">
                        <h3 class="card-title">Ödemeler</h3>
                    </div>
                    <div class="card-block border-bottom">
                        <div class="">
                            </b><h4 class="text-center">Ödeme Girişi</h4>
                        </div>
                        <div class="table-responsive">
                            <div class="container-fluid ">
                                <div class="col-sm-12">
                                    <form autocomplete="off" id="odemeForm">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="form-group col-md-2">
                                                <label class="form-control-label" for="paket">Paket /
                                                    Üyelik </label>
                                                <select class="form-control" id="id_paket" name="paket">
                                                    <option>&nbsp;</option>
                                                    {% for abonelik in abonelikler %}
                                                        <option value="{{ abonelik.paket_id }}">{{ abonelik }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label class="form-control-label" for="id_tutar">Tutar</label>
                                                <input type="number" class="form-control" id="id_tutar"
                                                       name="tutar" placeholder="Tutar"
                                                       autocomplete="off">
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label class="form-control-label" for="id_tarih">Tarih</label>
                                                <input type="date" class="form-control" id="id_tarih"
                                                       name="tarih" placeholder="Tarih"
                                                       autocomplete="off">
                                            </div>
                                            <div class="form-group col-md-4">
                                                <label class="form-control-label" for="id_aciklama">
                                                    Açıklama</label>
                                                <input type="text" class="form-control" id="id_aciklama"
                                                       name="aciklama" placeholder="Açıklama"
                                                       autocomplete="off">
                                            </div>
                                            <div class="form-group col-md-2">
                                                <label class="form-control-label" for="id_aciklama">İşlemler</label>
                                                <div class="row">
                                                    <div class="col-xs-6">
                                                        <a id="odemeKaydetBtn"
                                                           class="btn btn-outline btn-sm btn-success mr-2">Kaydet</a>
                                                    </div>
                                                    <div class="col-xs-6">
                                                        <a id="odemeTemizleBtn" onclick="formTemizle()"
                                                           class="btn btn-outline btn-sm btn-primary">Temizle</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-block">
                        <div>
                            <h4 class="text-center">Ödeme Listesi</h4>
                        </div>
                        <div class="table-responsive">
                            <div class="container-fluid ">
                                <div class="col-sm-12">
                                    <table class="table table-bordered dataTable table-fixed">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Tarih</th>
                                            <th>Tutar</th>
                                            <th>Paket / Abonelik</th>
                                            <th>Açıklama</th>
                                            <th>İşlemler</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for odeme in odemeler %}
                                            <tr>
                                                <td class="sorting_1">{{ forloop.counter }}</td>
                                                <td>{{ odeme.tarih }}</td>
                                                <td>{{ odeme.tutar }}</td>
                                                <td>{{ odeme.paket | default_if_none:"" }}</td>
                                                <td>{{ odeme.aciklama| default_if_none:"" }}</td>
                                                <td>
                                                    <a class="btn btn-primary btn-circle"
                                                       onclick="odemeDuzenle('{{ odeme.id }}')"
                                                       title="Kaydı Düzenle"><i
                                                            class="fa fa-edit black"></i></a>
                                                    <a href="{% url 'calendarapp:sil_odeme' odeme.id %}"
                                                       class="btn btn-danger btn-circle confirm-delete"
                                                       title="Sil"
                                                       data-toggle="modal"
                                                       data-target="#confirmDeleteModal"
                                                       id="delete_uye_{{ odeme.id }}">
                                                        <i class="fa fa-trash black"></i></a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="card card-shadow">
                    <div class="card-header">
                        <h3 class="card-title">Yapılacak Dersler</h3>
                    </div>
                    <div class="card-block">
                        <div class="table-responsive">
                            <div class="container-fluid ">
                                <div class="col-sm-12">
                                    <table class="table table-bordered dataTable table-fixed">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Kişiler</th>
                                            <th>Kort</th>
                                            <th>Antrenör</th>
                                            <th>Başlangıç - Bitiş</th>
                                            <th>İşlemler</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for etkinlik in yapilacak_etkinlikler %}
                                            <tr>
                                                <td class="sorting_1">{{ forloop.counter }}</td>
                                                <td>{{ etkinlik.grup }}</td>
                                                <td>{{ etkinlik.kort }}</td>
                                                <td>{{ etkinlik.antrenor |default_if_none:"" }}</td>
                                                <td>{{ etkinlik.baslangic_tarih_saat| date:'d F H:i' }}
                                                    - {{ etkinlik.bitis_tarih_saat| date:'H:i' }}</td>
                                                <td>
                                                    <button class="btn btn-danger">İptal Et</button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="card card-shadow">
                    <div class="card-header">
                        <h3 class="card-title">Geçmiş Dersler</h3>
                    </div>
                    <div class="card-block">
                        <div class="table-responsive">
                            <div class="container-fluid ">
                                <div class="col-sm-12">
                                    <table class="table table-bordered dataTable table-fixed">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Kişiler</th>
                                            <th>Kort</th>
                                            <th>Antrenör</th>
                                            <th>Yönetici Onayı</th>
                                            <th>Antrenör Onayı</th>
                                            <th>Üye Onayı</th>
                                            <th>Başlangıç - Bitiş</th>
                                            <th>İşlemler</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for etkinlik in yapilan_etkinlikler %}
                                            <tr>
                                                <td class="sorting_1">{{ forloop.counter }}</td>
                                                <td>{{ etkinlik.grup }}</td>
                                                <td>{{ etkinlik.kort }}</td>
                                                <td>{{ etkinlik.antrenor |default_if_none:"" }}</td>
                                                <td>{{ etkinlik.tamamlandi_yonetici |yesno:"Evet,Hayır" }}</td>
                                                <td>{{ etkinlik.tamamlandi_antrenor |yesno:"Evet,Hayır" }}</td>
                                                <td>{{ etkinlik.tamamlandi_uye |yesno:"Evet,Hayır" }}</td>
                                                <td>{{ etkinlik.baslangic_tarih_saat| date:'d F H:i' }}
                                                    - {{ etkinlik.bitis_tarih_saat| date:'H:i' }}</td>
                                                <td>
                                                    <button class="btn btn-success">Tamamlandı</button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="card card-shadow">
                    <div class="card-header">
                        <h3 class="card-title">İptal Edilen Dersler</h3>
                    </div>
                    <div class="card-block">
                        <div class="table-responsive">
                            <div class="container-fluid ">
                                <div class="col-sm-12">
                                    <table class="table table-bordered dataTable table-fixed">
                                        <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Kişiler</th>
                                            <th>Kort</th>
                                            <th>Antrenör</th>
                                            <th>Başlangıç - Bitiş</th>
                                            <th>İptal Eden</th>
                                            <th>İptal Tarih</th>
                                            <th>İşlemler</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for etkinlik in yapilan_etkinlikler %}
                                            <tr>
                                                <td class="sorting_1">{{ forloop.counter }}</td>
                                                <td>{{ etkinlik.grup }}</td>
                                                <td>{{ etkinlik.kort }}</td>
                                                <td>{{ etkinlik.antrenor |default_if_none:"" }}</td>
                                                <td>{{ etkinlik.baslangic_tarih_saat| date:'d F H:i' }}
                                                    - {{ etkinlik.bitis_tarih_saat| date:'H:i' }}</td>
                                                <td>{{ etkinlik.iptal_eden |default_if_none:"" }}</td>
                                                <td>{{ etkinlik.iptal_tarih_saat |default_if_none:"" }}</td>
                                                <td>
                                                    <button class="btn btn-info">Telafi Oluştur</button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <script>
        $('#odemeKaydetBtn').click(function () {
            let form = $('#odemeForm');
            form.append('<input type="hidden" name="uye" value="{{ uye.id }}">');
            let datas = form.serialize();
            $.ajax({
                url: "{% url 'calendarapp:kaydet_uye_odemesi_ajax' %}",
                data: datas,
                type: "post",
                dataType: 'json',
                success: function (data) {
                    if (data.status == "success") {
                        popupMesajGoster(data.message, data.status);
                        setTimeout(function () {
                            window.location.reload();
                        }, 1500);
                    } else {
                        popupMesajGoster(data.message, data.status);
                    }
                }
            });
        });

        function odemeDuzenle(id) {
            $.ajax({
                url: "{% url 'calendarapp:getir_odeme_by_id_ajax' %}",
                data: {id: id},
                type: "get",
                dataType: 'json',
                success: function (result) {
                    if (result.status == "success") {
                        for (let item in result.data) {
                            $('#odemeForm').append('<input type="hidden" class="form-control" name="id" value="' + result.data.id + '">');
                            $('#odemeForm').append('<input type="hidden" name="uye" value="{{ uye.id }}">');
                            if (result.data[item] != "null" || result.data[item] != "undefined" || result.data[item] != "") {
                                let key = item == 'id' ? 'pk' : item
                                let element = document.getElementById("id_" + key);
                                if (element)
                                    element.value = result.data[item];
                            }
                        }
                    } else {
                        popupMesajGoster(data.message, data.status);
                    }
                }
            });
        }

        function formTemizle() {
            let elements = document.getElementsByClassName("form-control");
            for (let i = 0; i < elements.length; i++) {
                elements[i].value = "";
            }
        }
    </script>
{% endblock content %}